---
layout: post
title: "(preview)抽選会の手間を減らすSmartLotteryをリリースしました"
excerpt_separator: <!--more-->
---
<!--more-->

<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/bb494db0-ebcf-4550-957f-905f17abf10d  width=40%>

抽選会開催者の手間を減らす手助けするアプリ「SmartLotetry」をリリースしました。

# はじめに
Rails7とHotwireを使用し、自作サービス **SmartLottery** をリリースしました。

- リポジトリ
[OdenTakashi/SmartLottery: SmartLottery](https://github.com/OdenTakashi/SmartLottery)

- サービスURL
[SmartLottery](https://smartlottery.fly.dev/welcome)

# 目次
- [はじめに](#はじめに)
- [自己紹介](#自己紹介) 
- [SmartLotteryの紹介](#SmartLotteryの紹介) 
  - [SmartLotteryとは](#SmartLotteryとは) 
  - [このサービスが解決すること](#このサービスが解決すること) 
  - [使い方](#使い方) 
- [サービスを作ろうと思ったきっかけ](#サービスを作ろうと思ったきっかけ) 
- [技術スタック](#技術スタック) 
- [開発について](#開発について) 
- [終わりに](#終わりに) 

# 自己紹介
odentakashi(@odentakashi)です。私はフィヨルドブートキャンプでプログラミングの勉強をしており、その最終課題である自作サービスをリリースしました。
この記事では自作サービスを作っていく中での苦労や勉強になったことを書いていきます。

# SmartLotteryの紹介

## Smartlotteryとは
このサービスは **複数人にプレゼントを送る際に発生する手間を解決するための抽選アプリ** です。<br>
抽選会を作成するだけで応募フォームを生成しそのフォームから応募してもらうことによって、抽選、当選メールの送信をこのアプリが自動で行います。

## このサービスが解決すること
上述の通りこのサービスは **複数人にプレゼントを送る際に発生する手間を解決するための抽選アプリ** です。<br>
もし抽選会を開催するとなった場合、以下のような手順で抽選会を開催することが多いのではないかと思います。

1. Google formで応募フォームを作成する
2. 作成した応募フォームを送り応募してもらう
3. 締め切り時刻になったら手動で抽選を行う
4. 抽選結果をもとに当選者にメールを手動で送信

このように列挙してみると手順が多く手間がかかります。 <br>

まさにこの手間を解決するのが **SmartLottery** です。 <br>

SmartLotteryを使った場合ですと

1. 抽選会を作成する
2. 生成された応募フォームを送り応募してもらう

実際に手動で行う作業はこれだけで、この後はアプリ側が抽選、当選メールの送信を行ってくれます。

## 使い方
### 抽選会作成者

#### 1. 抽選会を作成する
<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/b6184cd7-5903-46c2-af5e-d689b8efd9a0  width=50%>

<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/2efe675a-5346-4d6f-891d-1472d9e9767f  width=50%>

一つの抽選会に複数の賞品を登録可能です

#### 2. 応募フォームのURLをコピーする

<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/23b7e8b8-4f7b-45f7-acbb-b72f163c433b  width=50%>

#### 3. URLを共有する

URLを抽選会参加希望者に対して共有します。<br>
設定した締め切り日を過ぎますと応募ができなくなるため注意が必要です。

#### 4.当選メールが送信されるまで待つ
締切日の翌日01:00(日本時間)に抽選が開始されます。<br>
また抽選が行われると抽選詳細ページにて当選者が表示されます。

<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/e5e65b7a-63d4-4979-b8f7-b1c7553b5d91  width=50%>

### 応募希望者

#### 1. 共有されたURLにアクセスする
抽選会作成者から共有されたURLにアクセスを行います。

#### 2. 応募フォームに入力事項を入力

<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/8aaa18f9-0d02-4882-a977-89e52a93b27d  width=50%>

#### 3. 抽選を待つ
応募しますと以下のような画面が表示されます。<br>
この画面が表示されたら後は、抽選が行われるのを待ちます。

<img src=https://github.com/OdenTakashi/SmartLottery/assets/81839214/06324452-7450-414e-8b3c-ae88d84ea65b  width=50%>


## サービスを作ろうと思ったきっかけ
私の所属するフィヨルドブートキャンプでは、プレゼント企画というものがあります。<br>
流れとしては締切日を設け、プレゼントの企画者の方が作成したGoogleフォームを利用し、生徒の方が応募をします。<br>
そして締切日になった際に、企画者の方が **Array#sample**を用い抽選を行い当選者にメールを送るというものです。<br>

その中で、この手順を手動で行うのは大変であるという声があったため今回最終課題として作ることにしました。

## 技術スタック
- Ruby 3.2.2
- Ruby on Rails 7.0.6
- Hotwire
  - turbo-rails 1.4.0
  - stimulus-rails 1.2.1
- Slim 5.1.1
- Devise 4.9.2
- Rubocop 1.55.1
- Slim-Lint 0.24.0
- RSpec 6.0.3
- Tailwind CSS
- Github Actions
- Fly.io

## 開発について
開発の流れとしては、初めにエレベータピッチを作成し、ペーパープロトタイプを作成、技術検証、DB&リソース設計、そして実際に作成するというものでした。<br>
この中で自分はアイデア出しの段階でとても苦労してしまいました。<br>

アプリを作る際に大事なのはそのサービスが何かしらの問題を解決できるかという点、既存のサービスでその問題を解決できない点です。<br>
その点を考慮すると自分の出すアイデアは既存のサービスで解決できてしまうものばかりで、自分が作る必要のないものでした。<br>
アプリを作るというのは実装だけではないということを身をもって感じた瞬間でした。

実装に入ってからは初めて触るインフラ周り、CIなどなど何もわからないことばかりでした。<br>
しかし慣れてみるととても便利で、「自分はこれしかやらなくていいの?」と思うほどでした。<br>
また実装の中で使用したライブラリなどもとても便利なものがあり、実際にこれを作ってくれている方がいるというありがたみを強く実感しました。<br>

今回の開発とは少し逸れてしまいますが将来的には自分も何かしらの形で貢献したいという気持ちもあり、その第一歩として実際に開発の中で利用したライブラリ<br>に
PRを送るということもしました。(typo修正ですが💦)

[docs: fixed typo in History\.md by OdenTakashi · Pull Request \#630 · nathanvda/cocoon](https://github.com/nathanvda/cocoon/pull/630)

### 苦労したこと
#### メール配信サービスの選定
今回、Deviseを使った登録時、登録情報変更時、パスワード変更時、当選結果を伝える際にメール配信を行っています。<br>
その際にどのメール配信サービスを使うかという点を決めることが難しかったです。

結果的にはGmailの配信サービスを利用しメールを配信しています。
しかしこの選択は妥協案なのでこれから改善していきたい点の一つとなっています。

当初Gmailの配信サービスを利用することについてkomagataさんから他の配信サービスを検討した方がいいかもしれませんとアドバイスをいただきました。<br>
理由としては、

- メール配信がスパムとして扱われてしまい、Gmailアカウント停止の可能性がある
- 本番環境でGmailの配信サービスを使うことはあまりない

といったものです。

この背景にはメール配信自体がスパムの温床となっていることが挙げられます。<br>
そこで別のメール配信サービスを検討しました。検討したメール配信サービスは以下の通りです。

- Mailgun
- Postmark
- SendGrid

今回の受け入れの条件は以下の通りでした。

- 価格が無料もしくは格安であること
- メール配信が問題なく行われること
- 導入が大変過ぎないこと

この点を考慮して検討を進めました。
まずそれぞれの料金体系は以下の通りでした。

##### Mailgun

- 30日間は月5000通まで無料枠
- 30日間以降はプランに入る必要がある(月35$~)

##### Postmark

- 独自ドメインのメールアドレスを取る必要がある。
- 月100通までは無料

##### SendGrid
SendGrid登録の際に、法人向けと書かれており個人向けではないと書かれていたためダメ元で申請してみたのですが、

> 本サービスは法人向けに提供されており、
> 任意団体のお客様のお申し込みは受け付けておりませんので、念のため確認しております

というメールが届きこちらは使用できないと判断しました。

検討をしたところPostmarkが有力となっていたのですが、一点気になるのは「月100通までは無料」という点でした。<br>
理由としては実際にこのサービスがどれだけのメールを配信することになるのか今の段階では予想がつかないためです。

これらの事実に加えてフィヨルドブートキャンプの卒業生の方がGmailの配信サービスを利用していることから <br>
現段階ではGmailの配信サービスを利用しつつ配信数の目安がついてからサービスを乗り換えるという判断をしました。

#### ヒアリングの難しさ
フィヨルドブートキャンプ内であったら便利という声があったものを作成したため、<br>
細かい仕様についてはヒアリングが必要でした。<br>

しかし事前にヒアリングを行い内容を理解していたつもりだったのですが、実際に実装を進めてみると、<br>
仕様についてわからない点が多々出てきてしまいました。そのため少し作って確認をするという形で実装を進めました。<br>
またヒアリングを行う際のコツとして事前に完璧でなくていいので仕様を自分で考えてみるのが良いということをアドバイスいただきました。<br>

このような経験からある程度叩き台のようなものを用意した状態でないと、ヒアリングで得られる情報量は減ってしまうということを学びました。

### やってよかったこと
#### 作業の記録を残す
実装を進めていく中でわからない箇所が無数にあったため、ログを残さず作業をし続けていたのですが、<br>
気づいたらどこまで作業したのか、どこで詰まっているのかということがわからず迷子のような状態になってしまうことがありました。<br>
この状況に陥ってしまうとわからない箇所の特定が難しいため、質問もしにくくなってしまいます。<br>

その際の付き合い方として自分の作業の記録を残すということを導入しました。<br>
ひたすらに自分が行ったこと、行ったことの結果、考えたことを書いていくということなのですが<br>
これを行うとどこでわからなくなったのかがわかる、またわからない箇所がはっきりするため、質問もしやすくなりました。<br>
結果的にわからないことへの恐怖心が格段と減ったことに繋がりとても良い知見であったなと思います。

#### 抱え込まず質問、相談する
実装を始めていく中で一番意識していたことがこの抱え込まず質問、相談するということです。<br>
実際に詰まってしまう箇所は無数とあったため自分では解決できないこと、解決したけど方法が好ましいかどうかという点が多々ありました。<br>

そのような時は抱え込んでしまうと気持ちがしんどくなってしまうため、ある程度時間を決めその時間を超えたら質問するという形を取っていました。<br>

また質問する際に意識していたことは自分なりの答えを持つということ、情報を省略をしないということです。<br>
ただ「わかりません」と相談するのではなく、問題の解像度を上げるために以下のようなフォーマットでわからないを分解していました.<br>

- 質問の背景(どこの処理の話か、何をしようとしたかなど)
- 何を期待するのか
- 結果はどうなったのか
- 何を試したのか
- 自分なりにの考えor仮説

このフォーマットが正しいのかはわかりませんが、少なからず問題の解像度は上がっていたのではないかと思います。<br>
このようなフォーマットに当てはめながら調査をしていると自己解決することが何度もありました。<br>
これからもこの方法は役に立つと思うので、身をもって体験ができてとても勉強になりました。

### おわりに
開発は全体的にとても楽しく進めることができました。進捗が出ない期間などもありましたが<br>
作業の記録を残すようにしたりと自分なりの工夫をすることに加え週に一回の自作サービスの進捗会などで<br>
相談をさせていたたくことによりモチベーションを保つことができました。<br>

また開発の途中で一番辛かったことは時間をかけて実装してみたが振り返ると大した処理ではない感じてしまう点でした。<br>
このような気持ちを日報に書いたところkomagataさんから以下のようなお言葉をいただき、とても心が軽くなりました。<br>
ありがとうございます。🙏

> 元々どんなはたから見たらちょっとしたWebサービスでも作るのはとっても大変なものです。気にしなくていいと思います。
> それだけにちゃんとしたサービスを公開している人は外からは見えないほど労力を使っているってことっすね。

リリースまで様々なアドバイスをしてくださったkomagataさん、machidaさん、メンターの皆様、そして関わってくださった受講生の皆様<br>
のおかげでプログラミングを詰まりながらも楽しく学習することができました。ありがとうございます。
